<!--
  TAKOBOTO RECALL CARD - BACK SIDE
  ===============================
  
  This template shows the answer for recall cards, displaying:
  - The front side (meaning/definition)
  - Japanese word/phrase (the answer)
  - Reading/pronunciation
  - Example sentence with translation
  - Optional image
  - External resource links
  - Audio/TTS functionality
  
  Features:
  - Bilingual support (Spanish/English meanings)
  - Multiple external dictionary links
  - Native audio with TTS fallback
  - Takoboto app integration
  - Special formatting for kana-only words and suru verbs
-->

<!-- Include the front side of the card -->
{{FrontSide}}

<!-- Answer indicator (hidden by default) -->
<div class="outside"> Answer</div>

<!-- Main answer container with white background -->
<div class="card-back shadow">
    <!-- PRIMARY ANSWER: Japanese word/phrase -->
    <div id="idReading" class="back">{{Japanese}}</div>
    
    <!-- Reading/pronunciation section -->
    {{#Reading}}
    <div class="backopt">{{Reading}}</div>
    <hr />
    {{/Reading}}

    <!-- MEANING/DEFINITION SECTION (repeated from front for reference) -->
    <!-- Priority: Spanish meaning if available, otherwise English -->
    {{#Significado}}
    <div class="back">{{Significado}}</div>
    {{/Significado}}
    {{^Significado}}
    <div id="idMeaning" class="back">{{Meaning}}</div>
    {{/Significado}}
    <hr />

    <!-- EXAMPLE SENTENCE SECTION -->
    <!-- Japanese example sentence -->
    {{#Sentence}}
    <div class="backopt">{{Sentence}}</div>
    {{/Sentence}}
    
    <!-- Sentence translation (Spanish priority, English fallback) -->
    {{#SignificadoOracion}}
    <div class="backopt">{{SignificadoOracion}}</div>
    {{/SignificadoOracion}}
    {{^SignificadoOracion}}
    <div class="backopt">{{SentenceMeaning}}</div>
    {{/SignificadoOracion}}

    <!-- OPTIONAL IMAGE SECTION -->
    {{#Image}}
    <hr />
    <div class="backopt">{{Image}}</div>
    {{/Image}}
    
    <!-- EXTERNAL RESOURCES SECTION -->
    <hr />
    <div class="backopt">
        <!-- Jisho.org - Popular Japanese-English dictionary -->
        <a class="link" href="https://jisho.org/search/{{text:Japanese}}">
            Jisho
        </a>
        <br>
        <!-- Google Images - Visual references -->
        <a class="link" href="https://www.google.com/search?tbm=isch&q={{text:Japanese}}">
            Google images
        </a>
        <br>
        <!-- Irasutoya - Japanese illustration site -->
        <a class="link" href="https://www.irasutoya.com/search?q={{text:Japanese}}">
            Irasutoya
        </a>
        <br>
        <!-- Takoboto Web - Online version of the app -->
        <a class="link" href="http://takoboto.jp/?q={{text:Japanese}}&lang=spa">
            Takoboto Web
        </a>
        <br>
        <!-- Tatoeba - Example sentences database -->
        <a class="link" href="https://tatoeba.org/en/sentences/search?from=jpn&query={{text:Japanese}}">
            Tatoeba
        </a>
        
        <!-- Optional direct link to Takoboto app -->
        {{#Link}}
        <br>
        <a href="{{Link}}">
            Open in Takoboto
        </a>
        {{/Link}}
    </div>
</div>

<!-- AUDIO SECTION -->
<!-- Native speaker audio (if available) -->
{{#Audio}}
{{Audio}}
{{/Audio}}

<!-- Text-to-Speech fallback (when no native audio) -->
{{^Audio}}
<div id="tts">
    <!-- Android TTS for the main word -->
    <tts service="android" voice="ja_JP">{{kanji:Japanese}}</tts>
    <!-- Apple TTS alternative for the main word -->
    {{tts ja_JP voices=Apple_Otoya:kanji:Japanese}}
</div>
{{/Audio}}

<!-- TTS for example sentences -->
<div id="tts">
    {{#Sentence}}
    <!-- Android TTS for the sentence -->
    <tts service="android" voice="ja_JP">{{kanji:Sentence}}</tts>
    {{/Sentence}}
</div>
<div id="tts">
    {{#Sentence}}
    <!-- Apple TTS alternative for the sentence -->
    {{tts ja_JP voices=Apple_Otoya:kanji:Sentence}}
    {{/Sentence}}
</div>

<!-- JAVASCRIPT FUNCTIONALITY -->
<script>
/*
 * BACK CARD JAVASCRIPT FUNCTIONALITY
 * ==================================
 * 
 * This script handles special cases and automatic formatting:
 * 1. Kana-only words: Highlighted in yellow
 * 2. Suru verbs: Automatically appends " + する" to the display
 * 
 * Note: This is the same logic as the recognition front card,
 * but applied to the answer display in recall mode.
 */

// Get the note content to check for special indicators
var note = document.getElementById("idNote").textContent

if (note) {
    // Handle words that are usually written in kana only
    if (note.includes("Usually written using kana alone")) {
        // Highlight the word in yellow to indicate it's typically kana-only
        document.getElementById("idReading").style.color = "yellow";
    }
    
    // Handle suru verbs (verbs that take the auxiliary verb する)
    if (note.includes("Takes the aux. verb suru")) {
        // Append " + する" to show this is a suru verb
        document.getElementById("idReading").innerHTML += ' + する';
    }
}
</script>