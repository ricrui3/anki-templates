<!--
  TAKOBOTO RECALL CARD - BACK SIDE
  ===============================
  
  This template shows the answer for recall cards, displaying:
  - The front side (meaning/definition)
  - Japanese word/phrase (the answer)
  - Reading/pronunciation
  - Example sentence with translation
  - Optional image
  - External resource links
  - Audio/TTS functionality
  
  Features:
  - Bilingual support (Spanish/English meanings)
  - Multiple external dictionary links
  - Native audio with TTS fallback
  - Takoboto app integration
  - Special formatting for kana-only words and suru verbs
-->

<!-- Include the front side of the card -->
{{FrontSide}}

<!-- Answer indicator (hidden by default) -->
<div class="outside"> Answer</div>

<!-- Main answer container with white background -->
<div class="card-back shadow">
    <!-- PRIMARY ANSWER: Japanese word/phrase -->
    <div id="idReading" class="back">{{Japanese}}</div>
    
    <!-- Reading/pronunciation section -->
    {{#Reading}}
    <div class="backopt">{{Reading}}</div>
    <hr />
    {{/Reading}}

    <!-- MEANING/DEFINITION SECTION (repeated from front for reference) -->
    <!-- Priority: Spanish meaning if available, otherwise English -->
    {{#Significado}}
    <div class="back">{{Significado}}</div>
    {{/Significado}}
    {{^Significado}}
    <div id="idMeaning" class="back">{{Meaning}}</div>
    {{/Significado}}
    <hr />

    <!-- EXAMPLE SENTENCE SECTION -->
    <!-- Japanese example sentence -->
    {{#Sentence}}
    <div class="backopt">{{Sentence}}</div>
    {{/Sentence}}
    
    <!-- Sentence translation (Spanish priority, English fallback) -->
    {{#SignificadoOracion}}
    <div class="backopt">{{SignificadoOracion}}</div>
    {{/SignificadoOracion}}
    {{^SignificadoOracion}}
    <div class="backopt">{{SentenceMeaning}}</div>
    {{/SignificadoOracion}}

    <!-- OPTIONAL IMAGE SECTION -->
    {{#Image}}
    <hr />
    <div class="backopt">{{Image}}</div>
    {{/Image}}
    
    <!-- ORGANIZED EXTERNAL RESOURCES SECTION -->
    <!-- Comprehensive collection of learning resources organized by category -->
    <details class="resources-section">
      <summary>🔗 Recursos de estudio</summary>
      
      <!-- Example sentence resources -->
      {{#Sentence}}
      <div class="resource-group">
        <h4>📝 Oración de ejemplo</h4>
        <div class="link-grid">
          <a href="https://www.deepl.com/translator#ja/es/{{text:kanji:Sentence}}" title="Traducir oración en DeepL" class="link-btn translate">
            🌐 DeepL</a>
          <a href="https://jpdb.io/search?q={{text:kanji:Sentence}}&lang=spanish#a" title="Detalles de la oración en JPDB" class="link-btn database">
            📊 JPDB</a>
          <a href="http://takoboto.jp/?q={{text:kanji:Sentence}}&lang=spa" title="Detalles de la oración en Takoboto Web" class="link-btn dictionary">
            🐙 Takoboto</a>
          <a href="intent:#Intent;package=jp.takoboto;action=jp.takoboto.SEARCH;S.q={{text:kanji:Sentence}};end" title="Takoboto Android" class="link-btn mobile">
            📱 Takoboto</a>
        </div>
      </div>
      {{/Sentence}}
      
      <!-- Main vocabulary resources -->
      <div class="resource-group">
        <h4>📚 Vocabulario</h4>
        
        <div class="resource-subgroup">
          <h5>Diccionarios</h5>
          <div class="link-grid">
            <a href="http://takoboto.jp/?q={{text:Japanese}}&lang=spa" title="Takoboto Web" class="link-btn dictionary">
              🐙 Takoboto</a>
            <a href="intent:#Intent;package=jp.takoboto;action=jp.takoboto.SEARCH;S.q={{text:Japanese}};end" title="Takoboto Android" class="link-btn mobile">
              📱 Takoboto</a>
            <a href="https://jisho.org/search/{{text:Japanese}}" title="Diccionario Jisho" class="link-btn dictionary">
              📖 Jisho</a>
            <a href="https://thesaurus.weblio.jp/content/{{text:Japanese}}" title="Sinónimos en Weblio" class="link-btn dictionary">
              📝 Weblio</a>
          </div>
        </div>

        <div class="resource-subgroup">
          <h5>Aprendizaje</h5>
          <div class="link-grid">
            <a href="https://www.wanikani.com/search?query={{text:Japanese}}" title="WaniKani" class="link-btn learning">
              🐊 WaniKani</a>
            <a href="kanjistudy://search?q={{text:Japanese}}" title="KanjiStudy búsqueda" class="link-btn mobile">
              🀄 Kanji Study</a>
            <a href="kanjistudy://draw?kanji={{text:Japanese}}" title="KanjiStudy dibujo" class="link-btn mobile">
              🖌️ Kanji Study Dibujo</a>
            <a href="https://conjugador.reverso.net/conjugacion-japones-verbo-{{text:Japanese}}.html" title="Conjugaciones de verbos" class="link-btn tools">
              🔄 Verbos</a>
          </div>
        </div>

        <div class="resource-subgroup">
          <h5>Contexto</h5>
          <div class="link-grid">
            <a href="https://sentencesearch.neocities.org/#{{text:Japanese}}" title="Oraciones de ejemplo" class="link-btn database">
              💬 Oraciones</a>
            <a href="https://tatoeba.org/en/sentences/search?from=jpn&query={{text:Japanese}}" title="Tatoeba - Base de datos de oraciones" class="link-btn database">
              💬 Tatoeba</a>
            <a href="https://www.irasutoya.com/search?q={{text:Japanese}}" title="Imágenes en Irasutoya" class="link-btn images">
              🎨 Irasutoya</a>
            <a href="https://www.google.com/search?tbm=isch&q={{text:Japanese}}" title="Búsqueda de imágenes" class="link-btn images">
              🖼️ Imágenes</a>
          </div>
        </div>

        <div class="resource-subgroup mobile-only">
          <h5>Apps móviles</h5>
          <div class="link-grid">
            <a href="intent:#Intent;package=jp.takoboto;action=jp.takoboto.SEARCH;S.q={{text:Japanese}};end" title="Takoboto Android" class="link-btn mobile">
              📱 Takoboto</a>
            <!-- Optional direct link to Takoboto app -->
            {{#Link}}
            <a href="{{Link}}" title="Abrir en Takoboto" class="link-btn mobile">
              🐙 Takoboto App</a>
            {{/Link}}
          </div>
        </div>
      </div>
      
    </details>
</div>

<!-- AUDIO SECTION -->
<!-- Native speaker audio (if available) -->
{{#Audio}}
    {{Audio}}
{{/Audio}}

<!-- Text-to-Speech fallback (when no native audio) -->
{{^Audio}}
<div id="tts">
    <!-- Android TTS for the main word -->
    <tts service="android" voice="ja_JP">{{kanji:Japanese}}</tts>
    <!-- Apple TTS alternative for the main word -->
    {{tts ja_JP voices=Apple_Otoya:kanji:Japanese}}
</div>
{{/Audio}}

<!-- JAVASCRIPT FUNCTIONALITY -->
<script>
/*
 * BACK CARD JAVASCRIPT FUNCTIONALITY
 * ==================================
 * 
 * This script handles special cases and automatic formatting:
 * 1. Kana-only words: Highlighted in yellow
 * 2. Suru verbs: Automatically appends " + する" to the display
 * 
 * Note: This is the same logic as the recognition front card,
 * but applied to the answer display in recall mode.
 */

// Get the note content to check for special indicators
var note = document.getElementById("idNote").textContent

if (note) {
    // Handle words that are usually written in kana only
    if (note.includes("Usually written using kana alone")) {
        // Highlight the word in yellow to indicate it's typically kana-only
        document.getElementById("idReading").style.color = "yellow";
    }
    
    // Handle suru verbs (verbs that take the auxiliary verb する)
    if (note.includes("Takes the aux. verb suru")) {
        // Append " + する" to show this is a suru verb
        document.getElementById("idReading").innerHTML += ' + する';
    }
}
</script>